<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SooqPro Admin</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
    }
    .login-container {
      background: rgba(255, 255, 255, 0.05);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
      text-align: center;
    }
    .logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 30px;
      font-size: 40px;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #888;
      margin-bottom: 40px;
    }
    .input-group {
      margin-bottom: 25px;
    }
    input[type="password"] {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 16px;
      outline: none;
      transition: all 0.3s;
    }
    input[type="password"]:focus {
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 0 2px #667eea;
    }
    input[type="password"]::placeholder {
      color: #666;
    }
    button {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    .error {
      color: #ff6b6b;
      margin-top: 15px;
      display: none;
    }
    .back-link {
      margin-top: 30px;
      color: #888;
      text-decoration: none;
      display: inline-block;
    }
    .back-link:hover {
      color: white;
    }
    .dashboard {
      display: none;
      max-width: 1200px;
      width: 95%;
    }
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
      flex-wrap: wrap;
      gap: 20px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 25px;
      border-radius: 16px;
      text-align: left;
    }
    .stat-label {
      color: #888;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #667eea;
    }
    .chart-container {
      background: rgba(255, 255, 255, 0.05);
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 20px;
    }
    .logout-btn {
      background: rgba(255, 255, 255, 0.1);
      width: auto;
      padding: 10px 25px;
    }
  </style>
</head>
<body>
  <div class="login-container" id="loginPage">
    <div class="logo">üîê</div>
    <h1>SooqPro Admin</h1>
    <p class="subtitle">Authorized Personnel Only</p>
    
    <div class="input-group">
      <input type="password" id="password" placeholder="Enter admin password" onkeypress="if(event.key==='Enter')login()">
    </div>
    
    <button onclick="login()">Access Dashboard</button>
    
    <p class="error" id="errorMsg">Invalid password. Please try again.</p>
    
    <a href="/sooqpro/" class="back-link">‚Üê Back to App</a>
  </div>

  <div class="dashboard" id="dashboard">
    <div class="dashboard-header">
      <div>
        <h1>üìä Admin Dashboard</h1>
        <p style="color: #888;">Overview of SooqPro marketplace</p>
      </div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total Listings</div>
        <div class="stat-value" id="totalListings">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Active Listings</div>
        <div class="stat-value" id="activeListings">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Expired Listings</div>
        <div class="stat-value" id="expiredListings">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Value</div>
        <div class="stat-value" id="totalValue">-</div>
      </div>
    </div>

    <div class="chart-container">
      <h3 style="margin-bottom: 20px;">Category Breakdown</h3>
      <div id="categoryChart" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
        <p style="color: #888;">Loading data...</p>
      </div>
    </div>
  </div>

  <script>
    const ADMIN_PASSWORD = 'sooqpro2024';
    
    function login() {
      const password = document.getElementById('password').value;
      const errorMsg = document.getElementById('errorMsg');
      
      if (password === ADMIN_PASSWORD) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        loadDashboardData();
      } else {
        errorMsg.style.display = 'block';
        document.getElementById('password').value = '';
      }
    }
    
    function logout() {
      document.getElementById('loginPage').style.display = 'block';
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('password').value = '';
    }
    
    function loadDashboardData() {
      // Try to get data from localStorage (used by Flutter app)
      const listings = JSON.parse(localStorage.getItem('sooqpro_listings') || '[]');
      
      const total = listings.length;
      const active = listings.filter(l => l.isActive !== false && !isExpired(l)).length;
      const expired = listings.filter(l => l.isExpired || isExpired(l)).length;
      const totalVal = listings.reduce((sum, l) => sum + (parseFloat(l.price) || 0), 0);
      
      document.getElementById('totalListings').textContent = total;
      document.getElementById('activeListings').textContent = active;
      document.getElementById('expiredListings').textContent = expired;
      document.getElementById('totalValue').textContent = 'OMR ' + totalVal.toLocaleString();
      
      // Category breakdown
      const categories = {};
      listings.forEach(l => {
        const cat = l.category || 'Other';
        categories[cat] = (categories[cat] || 0) + 1;
      });
      
      const chartDiv = document.getElementById('categoryChart');
      if (Object.keys(categories).length === 0) {
        chartDiv.innerHTML = '<p style="color: #888;">No listings yet</p>';
      } else {
        chartDiv.innerHTML = Object.entries(categories).map(([cat, count]) => `
          <div style="background: rgba(102, 126, 234, 0.2); padding: 15px 25px; border-radius: 12px; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #667eea;">${count}</div>
            <div style="color: #888; font-size: 14px;">${cat}</div>
          </div>
        `).join('');
      }
    }
    
    function isExpired(listing) {
      if (!listing.expiryDate) return false;
      return new Date(listing.expiryDate) < new Date();
    }
  </script>
</body>
</html>